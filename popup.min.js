!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():t()}(0,function(){"use strict";var e={sa:{},info:{},plugin_name:"WebPopup",lib_version:"1.27.11",plugin_version:"1.27.11",defaultPara:{platform:"H5",preload_image:!0,encrypt_cookie:!1},serverData:{},localData:{global_popup_count:[],local_update_time:null,eventQueue:[],update_time:null},eventRule:{},convertPlans:[],isRun:!1,setArg:function(e){var t={};if(e&&"[object Object]"===Object.prototype.toString.call(e)){for(var n in e)n&&"popup_window_content"!==n&&(t[n]=e[n]);return JSON.stringify(t,null,"  ")}return e},log:function(){if(!0===e.info.show_log&&"object"==typeof console&&"function"==typeof console.log)try{return arguments[0]=e.setArg(arguments[0]),arguments[1]=e.setArg(arguments[1]),console.log.apply(console,arguments)}catch(t){console.log(arguments[0])}},config:{storageName:"sensorsdata202002-popupdata",loadedSign:"SensorsData2015JSSDKH5PopupIsLoad"}},t={visibility:function(e){e=e||{};var t={hidden:undefined,visibilityChange:undefined,isSupported:function(){return"undefined"!=typeof this.hidden},_visible:e.onVisible,_hidden:e.onHidden,_nativeSwitch:function(){!0===document[this.hidden]?this._hidden():this._visible()},listen:function(){try{this.isSupported()?document.addEventListener(this.visibilityChange,function(){t._nativeSwitch.apply(t,arguments)},1):document.addEventListener?(window.addEventListener("focus",this._visible,1),window.addEventListener("blur",this._hidden,1)):(document.attachEvent("onfocusin",this._visible),document.attachEvent("onfocusout",this._hidden))}catch(e){}},init:function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()}};t.init()},getRgba:function(e){return"object"!=typeof e?e:"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"},conversionNum:function(e){if(e){if(/^[0|1]?\.\d+$/.test(e))return 100*Number(e)+"%";var t=/^(-?\d+(\.\d+)?)px$/.exec(e);return t?(Number(t[1])/375*window.screen.width).toFixed(2)+"px":e}},boxModel:function(e){return function(n){if("object"!=typeof n)return e+":"+n+";";var i="";for(var a in n)i+=e+"-"+a+":"+t.conversionNum(n[a])+";";return i}},localStorage:{get:function(e){return window.localStorage.getItem(e)},parse:function(e){var n=null;try{n=JSON.parse(t.localStorage.get(e))||null}catch(i){}return n},set:function(e,t){window.localStorage.setItem(e,t)},remove:function(e){window.localStorage.removeItem(e)},isSupport:function(){var e=!0;try{var n="__sensorsdatasupport__",i="testIsSupportStorage";t.localStorage.set(n,i),t.localStorage.get(n)!==i&&(e=!1),t.localStorage.remove(n)}catch(a){e=!1}return e}},addEvent:function(){function e(t){return t&&(t.preventDefault=e.preventDefault,t.stopPropagation=e.stopPropagation,t._getPath=e._getPath),t}e._getPath=function(){var e=this;return this.path||this.composedPath&&this.composedPath()||function(){try{var t=e.target,n=[t];if(null===t||null===t.parentElement)return[];for(;null!==t.parentElement;)t=t.parentElement,n.unshift(t);return n}catch(i){return[]}}()},e.preventDefault=function(){this.returnValue=!1},e.stopPropagation=function(){this.cancelBubble=!0};(function(t,n,i){if(t&&t.addEventListener)t.addEventListener(n,function(t){t._getPath=e._getPath,i.call(this,t)},!1);else{var a="on"+n,o=t[a];t[a]=function(t,n,i){return function(a){if(!(a=a||e(window.event)))return undefined;a.target=a.srcElement;var o,r,s=!0;return"function"==typeof i&&(o=i(a)),r=n.call(t,a),!1!==o&&!1!==r||(s=!1),s}}(t,i,o)}}).apply(null,arguments)},extend:function(e){var n=Array.prototype.slice;return t.each(n.call(arguments,1),function(t){for(var n in t)void 0!==t[n]&&(e[n]=t[n])}),e},extend2Lev:function(e){return t.each(Array.prototype.slice.call(arguments,1),function(n){for(var i in n)void 0!==n[i]&&(t.isObject(n[i])&&t.isObject(e[i])?t.extend(e[i],n[i]):e[i]=n[i])}),e},each:function(e,t,n){var i=Object.prototype.hasOwnProperty,a=Array.prototype.forEach,o={};if(null==e)return!1;if(a&&e.forEach===a)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,s=e.length;r<s;r++)if(r in e&&t.call(n,e[r],r,e)===o)return!1}else for(var p in e)if(i.call(e,p)&&t.call(n,e[p],p,e)===o)return!1},xhr:function(e){if(e)return"undefined"!=typeof window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?new XMLHttpRequest:"undefined"!=typeof XDomainRequest?new XDomainRequest:null;if("undefined"!=typeof window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}},ajax:function(e){function n(e){if(!e)return"";try{return JSON.parse(e)}catch(t){return{}}}e.timeout=e.timeout||2e4,e.credentials="undefined"==typeof e.credentials||e.credentials;var i=t.xhr(e.cors);if(!i)return!1;e.type||(e.type=e.data?"POST":"GET");var a,o=(e=t.extend({success:function(){},error:function(){}},e)).success,r=e.error;e.success=function(e){o(e),a&&(clearTimeout(a),a=null)},e.error=function(e){r(e),a&&(clearTimeout(a),a=null)},a=setTimeout(function(){!function(){try{t.isObject(i)&&i.abort&&i.abort()}catch(n){sd.log(n)}a&&(clearTimeout(a),a=null,e.error&&e.error(),i.onreadystatechange=null,i.onload=null,i.onerror=null)}()},e.timeout),"undefined"!=typeof XDomainRequest&&i instanceof XDomainRequest&&(i.onload=function(){e.success&&e.success(n(i.responseText)),i.onreadystatechange=null,i.onload=null,i.onerror=null},i.onerror=function(){e.error&&e.error(n(i.responseText),i.status),i.onreadystatechange=null,i.onerror=null,i.onload=null}),i.onreadystatechange=function(){try{4==i.readyState&&(i.status>=200&&i.status<300||304==i.status?e.success(n(i.responseText)):e.error(n(i.responseText),i.status),i.onreadystatechange=null,i.onload=null)}catch(t){i.onreadystatechange=null,i.onload=null}},i.open(e.type,e.url,!0);try{e.credentials&&(i.withCredentials=!0),t.isObject(e.header)&&t.each(e.header,function(e,t){i.setRequestHeader&&i.setRequestHeader(t,e)}),e.data&&(e.cors||i.setRequestHeader&&i.setRequestHeader("X-Requested-With","XMLHttpRequest"),"application/json"===e.contentType?i.setRequestHeader&&i.setRequestHeader("Content-type","application/json; charset=UTF-8"):i.setRequestHeader&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"))}catch(s){sd.log(s)}i.send(e.data||null)},getUuid:function(){var e=function(){return Math.random().toString(16).replace(".","")};return function(){var t=function(){for(var e=1*new Date,t=0;e==1*new Date;)t++;return e.toString(16)+t.toString(16)}()+"-"+e()+"-"+e();return t||(String(Math.random())+String(Math.random())+String(Math.random())).slice(2,15)}},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},isEmptyObject:function(e){var n=Object.prototype.hasOwnProperty;if(t.isObject(e)){for(var i in e)if(n.call(e,i))return!1;return!0}return!1},filter:function(e,t,n){var i=Object.prototype.hasOwnProperty;if(e.filter)return e.filter(t);for(var a=[],o=0;o<e.length;o++)if(i.call(e,o)){var r=e[o];t.call(n,r,o,e)&&a.push(r)}return a},isObject:function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},getConvertNumberValue:function(e){return t.isString(e)&&(e=Number(e)),Math.floor(1e3*e)/1e3},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},isDate:function(e){return"[object Date]"==Object.prototype.toString.call(e)},isBoolean:function(e){return"[object Boolean]"==Object.prototype.toString.call(e)},isNumber:function(e){return"[object Number]"==Object.prototype.toString.call(e)&&/[\d\.]+/.test(String(e))},isFunction:function(e){if(!e)return!1;var t=Object.prototype.toString.call(e);return"[object Function]"==t||"[object AsyncFunction]"==t},getURLSearchParams:function(e){for(var t=function(e){return decodeURIComponent(e)},n={},i=(e=e||"").substring(1).split("&"),a=0;a<i.length;a++){var o=i[a].indexOf("=");if(-1!==o){var r=i[a].substring(0,o),s=i[a].substring(o+1);r=t(r),s=t(s),n[r]=s}}return n},URL:function(e){var n,i={},a=["hash","host","hostname","href","origin","password","pathname","port","protocol","search","username"];if("function"==typeof window.URL&&function(){try{return"http://modernizr.com/"===new URL("http://modernizr.com/").href}catch(e){return!1}}())(i=new URL(e)).searchParams||(i.searchParams=(n=t.getURLSearchParams(i.search),{get:function(e){return n[e]}}));else{if(!1===/^https?:\/\/.+/.test(e))throw"Invalid URL";var o=document.createElement("a");o.href=e;for(var r=a.length-1;r>=0;r--){var s=a[r];i[s]=o[s]}i.hostname&&"string"==typeof i.pathname&&0!==i.pathname.indexOf("/")&&(i.pathname="/"+i.pathname),i.searchParams=function(){var e=t.getURLSearchParams(i.search);return{get:function(t){return e[t]}}}()}return i},contentLoaded:function(e,t){var n=!1,i=!0,a=e.document,o=a.documentElement,r=a.addEventListener,s=r?"addEventListener":"attachEvent",p=r?"removeEventListener":"detachEvent",l=r?"":"on",c=function(i){"readystatechange"==i.type&&"complete"!=a.readyState||(("load"==i.type?e:a)[p](l+i.type,c,!1),!n&&(n=!0)&&t.call(e,i.type||i))},u=function(){try{o.doScroll("left")}catch(e){return void setTimeout(u,50)}c("poll")};if("complete"==a.readyState)t.call(e,"lazy");else{if(!r&&o.doScroll){try{i=!e.frameElement}catch(_){}i&&u()}a[s](l+"DOMContentLoaded",c,!1),a[s](l+"readystatechange",c,!1),e[s](l+"load",c,!1)}},indexOf:function(e,t){var n=e.indexOf;if(n)return n.call(e,t);for(var i=0;i<e.length;i++)if(t===e[i])return i;return-1}};e._=t,e.isSupportPopup=function(){return t.localStorage.isSupport()},e.listenPageStateChange=function(){var n=!0;t.visibility({onVisible:function(){e.log("\u9875\u9762\u89e6\u53d1visible-",(new Date).getMinutes(),"\u5206",(new Date).getSeconds()),!1===n&&(e.updateDataAndSetListen.startState(),n=!0)},onHidden:function(){e.log("\u9875\u9762\u89e6\u53d1hidden-",(new Date).getMinutes(),"\u5206",(new Date).getSeconds()),!0===n&&(e.updateDataAndSetListen.stopAllState(),n=!1)}})},e.getWebSDK=function(){return!!(t.isObject(window.sensorsDataAnalytic201505)&&t.isObject(window.sensorsDataAnalytic201505.readyState)&&window.sensorsDataAnalytic201505.readyState.state>=3)&&window.sensorsDataAnalytic201505},e.getPopupInfo=function(e){if(!t.isObject(e)||!t.isObject(e.template))return{};var n={$sf_msg_title:"",$sf_msg_content:"",$sf_msg_image_url:""};return function i(e){t.each(e.subviews,function(e){var t=e.properties||{};"title"===t.msgType?n.$sf_msg_title=t.text:"content"===t.msgType?n.$sf_msg_content=t.text:"image"===e.type&&(n.$sf_msg_image_url=t.image),e.subviews&&i(e)})}(e.template),n},e.getSFCampaign=function(e){e=t.isObject(e)?e:{};var n={planId:"",name:"",content:null,type:""};return n.planId=e.plan_id||"",n.name=e.cname||"",n.content=t.isObject(e.popup_window_content)?e.popup_window_content.content:"",n.type=t.isObject(e.popup_window_content)&&e.popup_window_content.popup_type?e.popup_window_content.popup_type:"PRESET",n},e.getImageList=function(e){if(!t.isArray(e))return!1;for(var n,i,a=new RegExp('("(backgroundImage|image)":"(http(s)?://.[^"]*)")',"g"),o=new RegExp('http(s)?://.[^S^"]*'),r={},s=e.length,p=[],l=0;l<s;l++)if(t.isObject(e[l])&&"ACTIVE"===e[l].status.toLocaleUpperCase()&&!0===e[l].is_audience&&(e[l].strategy_id?!1!==e[l].is_trigger:!0!==e[l].is_control_group)&&e[l].popup_window_content&&e[l].popup_window_content.content&&(n=e[l].popup_window_content.content.match(a)))for(var c=0,u=n.length;c<u;c++)(i=n[c].match(o))&&i.length>0&&(r[i[0]]||(r[i[0]]=1));return t.each(r,function(e,t){p.push(t)}),p},e.setIsLoad=function(){if(window.self===window.top){if(window[e.config.loadedSign])return!1;if("undefined"==typeof window[e.config.loadedSign])return window[e.config.loadedSign]=!0,!0}else try{return!window.top[e.config.loadedSign]&&(window.top[e.config.loadedSign]=!0,!0)}catch(t){return e.log("\u975e\u540c\u57df\u540diframe\u5185\u5d4c\u4e0d\u80fd\u83b7\u53d6\u7236\u7ea7\u7a97\u4f53\u5185\u5bb9",t),!0}};var n={close:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAMAAAAPdrEwAAAAe1BMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////NgkbwAAAAKHRSTlMA5if6t/B0UjMSxpAtJB4MBfTr30oY6NjV0r2loZ6XkoaBenFp3UA/LNePaQAAAsxJREFUWMOsltlygzAMRRXMZsAsAZJmX9v6/7+wg1QXpjGxCDkvyWTIQZauDcCgzKLrPtnUSyGW9SbZX6OshDcQh36lH6j8MJ7pTZd6lGX6sr0IP7SDj7CA6chLoBkEFzm14nM1/P/2eGti1RZFq+LmdtwGw7afJ1Ue1dogcGCW4QptqCO2OPe1IbnL0Y7dE23wc2bJgSn44MFTvIMwLeMUXqZGfGKUkp+MPC2dwUjMGhWwUL7pnXRUsdbIIpow84VG1k9Xmf1e5U8Kq/R/68memAPqcggTCQUNc9SdL+iCL5jMd0B1j/RErh3LYrRyLa2po2x8KngJ9Uk5sWUwpZoVvIiiulNLhMwgHDhDED2MEH8X3zCDL4HV/R8lRTOEWYS0KWzt8GEm/mNLihpHKOeqJY6yLqDnbO42F1r9eXCzitMOfkuqfvkXTId6h1phSi5/ncbgneAtnDCAxTAzIn+POhfDFOObzAEsNLu0HXO06a4BCwd89wEk1h2ezdwl0rObvS5nNreHurg/lxKwsNPoHjXrHVhI+lMK3xjvMH4YelYzCSzc8V3zrx9CWtu5MG67eWEdhBSmI+GT7eIZt+Nny7YJ+y8ON9/cF1tWVL7LzTdTi6sSMtw9AE432wwl7u6MzqotMNwcM7Glc/TafRyB4+aa4dhdcoV993EDlptphlt3zZ72TgM8N88MDe3vDQWE5V6tWGaKyAbwqaiA5+aZQeETkk6QFtxuvhlaOkVwwxfgdq/IvHKbocBj6ac5OzYCIASBKGo10n+HBgakMswbaYDgTmX3fzgafhD4G+Hhg1cGXnT4PMFHVayCdVcBXGBu7cKwACOOC2YwTsIQ7KI7LBywJrlyByupK9Kw/lto4VFLAqLdmRwJiBDWwjDOI0QPPhPXRn3yTlyrILND4w7oOw3h5AlTPk5U/ddrZSk4RWW+C9hp2rgru6GiP/678n2UFPV1AAAAAElFTkSuQmCC"},i={row:"div",column:"div",label:"pre",image:"img",button:"button",link:"button",image_button:"img"},a={textAlign:"text-align",font:"font-size",backgroundColor:"background-color",borderWidth:function(e){return"border-width: "+e+";border-style: solid;"},borderColor:"border-color",cornerRadius:"border-radius",backgroundImage:function(e){return"background-image:url("+e+");background-repeat: no-repeat;background-size: 100% 100%;"},margin:t.boxModel("margin"),padding:t.boxModel("padding"),maxHeight:"max-height",maxWidth:"max-width",scrollableX:function(e){if(e)return"overflow-x:auto;"},scrollableY:function(e){if(e)return"overflow-y:auto;"}};function o(e){this.properties=e.properties,this.template=e.template,this.maskEle=null,this.containerEle=null,this.msg={$sf_msg_title:"",$sf_msg_content:"",$sf_msg_image_url:"",$sf_succeed:"",$sf_fail_reason:"",$sf_msg_id:"",plan:{}},this.popupCheckInstance=null}o.prototype={constructor:o,render:function(){var n=this;if(document.querySelector("div[data-sf-mask]"))return!1;return n.template.isRoot=!0,n.containerEle=n.createView(n.template),n.maskEle=n.getElement({nodeName:"div",attr:{"data-sensors-click":!0},style:n.getStyle({position:"fixed",width:"100%",height:"100%",top:"0px",left:"0px",backgroundColor:t.getRgba(n.properties.maskColor),"z-index":999998})}),t.addEvent(n.maskEle,"click",function(i){var a=i.target.getAttribute("data-ele-mask"),o=n.properties,r=n.msg;if(!r)return!1;var s={$sf_close_type:"POPUP_CLOSE_MASK",$sf_msg_title:r.$sf_msg_title,$sf_msg_content:r.$sf_msg_content,$sf_msg_image_url:r.$sf_msg_image_url,$sf_msg_element_action:"close",$sf_msg_element_type:"mask",$sf_msg_action_id:o.maskActionId};return a&&o&&o.maskAction?(function(i,a){var o=i.maskAction.H5,r=t.isArray(o)&&o[0];if(t.isObject(r))switch(a.$sf_close_type=r.$sf_close_type||"",a.$sf_msg_element_action=r.type||"",r.type){case"copy":e.track.trackEvent("$PlanPopupClick",a,n.msg);break;case"customize":case"openlink":e.track.trackEvent("$PlanPopupClick",a,n.msg),r.closeable&&n.destory();break;case"close":r.closeable&&(e.track.trackEvent("$PlanPopupClick",a,n.msg),n.destory())}}(o,s),!1):a&&n.properties.maskCloseEnabled?(e.track.trackEvent("$PlanPopupClick",s,r),n.destory(),!1):void e.track.elementClickCallback(i,n)}),n.maskEle.setAttribute("data-sf-mask",!0),n.maskEle.appendChild(n.containerEle),t.contentLoaded(window,function(){n.appendPopup()}),!0},appendPopup:function(){if(window.self===window.top)document.body.appendChild(this.maskEle);else try{window.top.document.body.appendChild(this.maskEle)}catch(n){document.body.appendChild(this.maskEle)}var e=document.querySelector("[data-ele-mask] > div"),t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;e&&e.offsetHeight>t&&(e.style.marginTop="auto")},getElement:function(e){var n=e.nodeName||"div",i=e.style,a=e.attr,o=e.prop,r=e.child,s=e.action,p=e.element_info,l=document.createElement(n);return i&&l.setAttribute("style",i),a&&t.each(a,function(e,t){e&&l.setAttribute(t,e)}),o&&t.each(o,function(e,t){e&&(l[t]=e)}),r&&r.length&&t.each(r,function(e){if(!e)return!1;l.appendChild(e)}),s&&s.H5&&s.H5.length&&l.setAttribute("data-action",JSON.stringify(s.H5)),p&&l.setAttribute("data-info",JSON.stringify(p)),l},getStyle:function(e){var n="",i=["msgType","text","image","name","isHidden","align","localImageName"];return t.each(e,function(e,o){e=t.conversionNum(e);var r=a[o];if(t.indexOf(i,o)>=0)return!1;t.isString(r)?n+=r+":"+t.getRgba(e)+";":t.isFunction(r)?n+=r(e)+";":n+=o+":"+t.getRgba(e)+";"}),n},createView:function(e){var a=[],o={"box-sizing":"border-box",display:"block","pointer-events":"auto",overflow:"hidden"},r={},s={},p=i[e.type]||null;e.properties=e.properties||{},e.layout=e.layout||{};var l=e.properties.font,c=l?1.7*parseInt(l)+"px":"normal";if(e.properties.isHidden)return!1;switch(e.properties.text?s.innerText=e.properties.text:e.properties.image&&(r["data-sensors-click"]=!0,e.properties.localImageName?r.src=n[e.properties.localImageName]:r.src=e.properties.image),e.isRoot&&(e.layout.margin.top="-40px",t.extend(o,{position:"relative","z-index":999999,"pointer-events":"none"})),e.type){case"row":o.display="flex";break;case"link":t.extend(o,{"text-decoration":"underline",outline:"none","letter-spacing":"1px","line-height":c});break;case"label":t.extend(o,{"white-space":"pre-wrap","word-wrap":"break-word","letter-spacing":"1px","line-height":c,"margin-top":"0px","margin-bottom":"0px"});break;case"button":t.extend(o,{outline:"none","letter-spacing":"1px","line-height":c})}t.extend(o,e.layout,e.properties),e.subviews&&e.subviews.length>0&&t.each(e.subviews,function(e){a.push(this.createView(e))},this);var u=this.getElement({element_info:{$sf_msg_element_type:e.type,$sf_msg_element_content:e.properties.text||""},nodeName:p,attr:r,prop:s,style:this.getStyle(o),child:a,action:e.action});if(e.layout.align){var _=document.createElement("div");o="display:flex;justify-content:"+{center:"center",left:"flex-start",right:"flex-end"}[e.layout.align]+";";return e.isRoot?(o+="width:100%;height:100%;overflow-y:auto;box-sizing: border-box;align-items:center;",_.setAttribute("style",o),_.setAttribute("data-ele-mask",!0)):_.setAttribute("style",o),_.appendChild(u),_}return u},destory:function(){var t=this.msg.plan.plan_id||"";if(window.self===window.top)document.body.removeChild(this.maskEle);else try{window.top.document.body.removeChild(this.maskEle)}catch(n){document.body.removeChild(this.maskEle)}e.info.popup_listener.onClose(t),e.info.popup_campaign_listener.onEnd(e.getSFCampaign(this.msg.plan)),this.popupCheckInstance&&this.popupCheckInstance.resetPopupIntervalWindow()}},e.ElementRender=o,e.handlerCampaign=function(n){var i,a=n,o=t.getUuid()(),r=a.plan.popup_window_content;if(!t.isObject(r))return a.popupFailed(1001,!1,{uuid:o,content:"",plan:a.plan}),!1;if(r.content)try{i=JSON.parse(r.content)}catch(u){e.log(u)}var s=e.getSFCampaign(a.plan),p={state:"",isCustom:!1},l=!0;try{l=e.info.popup_campaign_listener.shouldStart(s)}catch(u){l=!1,e.log(u)}var c={uuid:o,content:i,plan:a.plan};switch(a.plan.strategy_id?a.plan.is_trigger?l?"CUSTOMIZED"===r.popup_type?"withoutCampaignListener"===e.info.supportCustom?p.state="CAMPAIGN_CUSTOMIZED_NULL_LISTENER":"withoutStart"===e.info.supportCustom?p.state="CAMPAIGN_CUSTOMIZED_LISTENER_NULL_START":t.isString(r.content)?p.state="CAMPAIGN_TRIGGER_CUSTOMIZED_START":p.state="DIALOG_NOT_SHOW_JSON_FAILED":"PRESET"===r.popup_type&&t.isObject(i)&&t.isObject(i.properties)&&t.isObject(i.template)?p.state="DIALOG_SHOW":p.state="DIALOG_NOT_SHOW_JSON_FAILED":p.state="CAMPAIGN_NOT_START_LISTENER_START":p.state="CAMPAIGN_NOT_START_TRIGGER":a.plan.is_control_group?p.state="DIALOG_NOT_SHOW":l?t.isObject(i)&&i.properties&&i.template?p.state="DIALOG_SHOW":p.state="DIALOG_NOT_SHOW_JSON_FAILED":p.state="CAMPAIGN_NOT_START_LISTENER_START",p.isCustom=!(!r.popup_type||"CUSTOMIZED"!==r.popup_type),e.log("campaign:",p,"plan:",a.plan.cname),p.state){case"DIALOG_SHOW":a.showPopup(c);break;case"CAMPAIGN_TRIGGER_CUSTOMIZED_START":a.customCampaign(c);break;case"CAMPAIGN_NOT_START_LISTENER_START":a.popupFailed(1004,p.isCustom,c);break;case"CAMPAIGN_CUSTOMIZED_NULL_LISTENER":case"CAMPAIGN_CUSTOMIZED_LISTENER_NULL_START":a.popupFailed(1006,p.isCustom,c);break;case"DIALOG_NOT_SHOW_JSON_FAILED":a.popupFailed(1001,p.isCustom,c);break;case"CAMPAIGN_NOT_START_TRIGGER":a.popupFailed(1005,p.isCustom,c);break;case"DIALOG_NOT_SHOW":a.popupFailed(1003,p.isCustom,c);break;default:e.log("CampaignState\u5f02\u5e38")}},e.track={getPublicProps:function(n){var i=n.plan,a={$sf_lib_version:e.lib_version,$sf_plan_type:"\u8fd0\u8425\u8ba1\u5212",$sf_channel_service_name:"SENSORS_FOCUS",$sf_channel_category:"POPUP",$sf_platform_tag:e.info.platform,$sf_msg_id:n.$sf_msg_id};return t.isEmptyObject(i)||!t.isObject(i)?a:(a.$sf_plan_id=i.plan_id+"",a.$sf_plan_strategy_id=i.strategy_id?i.strategy_id:i.is_control_group?"-1":"0",i.audience_id&&(a.$sf_audience_id=i.audience_id+""),i.section_id&&(a.$sf_section_id=String(i.section_id),a.$sf_plan_type="\u65b0\u8d44\u6e90\u4f4d"),a)},popupDisplay:function(e){var t={$sf_msg_title:e.$sf_msg_title,$sf_msg_content:e.$sf_msg_content,$sf_msg_image_url:e.$sf_msg_image_url,$sf_succeed:e.$sf_succeed,$sf_fail_reason:e.$sf_fail_reason};this.trackEvent("$PlanPopupDisplay",t,e)},trackEvent:function(n,i,a){var o=e.track.getPublicProps(a);t.extend(i,o),t.each(i,function(e,t){""!==e&&e!==undefined||delete i[t]}),e.sa.track(n,i)},maskClick:function(e){if(!e.msg)return!1;var t={$sf_close_type:"POPUP_CLOSE_MASK",$sf_msg_title:e.msg.$sf_msg_title,$sf_msg_content:e.msg.$sf_msg_content,$sf_msg_image_url:e.msg.$sf_msg_image_url,$sf_msg_element_type:"mask",$sf_msg_action_id:e.properties.maskActionId};this.trackEvent("$PlanPopupClick",t,e.msg),e.destory()},elementClickCallback:function(n,i){var a=n.target,o=a.getAttribute("data-action"),r=a.getAttribute("data-info"),s=i.msg||{};if(!o)return!1;try{var p=(JSON.parse(o)||{})[0],l=JSON.parse(r)||{}}catch(n){e.log("elementClickCallback error",n)}var c={type:p.type,value:t.isString(p.value)?p.value:"",extra:t.isObject(p.value)?p.value:""},u=i.msg.plan?i.msg.plan.plan_id:"",_={$sf_msg_title:s.$sf_msg_title,$sf_msg_content:s.$sf_msg_content,$sf_msg_image_url:s.$sf_msg_image_url,$sf_msg_element_type:l.$sf_msg_element_type,$sf_msg_element_content:l.$sf_msg_element_content,$sf_msg_element_action:p.type,$sf_msg_action_id:p.id,$sf_close_type:"close"===p.type?p.$sf_close_type:""};this.trackEvent("$PlanPopupClick",_,s);try{e.info.popup_listener.onClick(u,c);var d=i.msg.plan;if(d){var f={name:d.cname,plan_id:d.plan_id,content:d.popup_window_content?d.popup_window_content.content:"",type:d.popup_window_content?d.popup_window_content.popup_type:"",action:c};e.info.popup_campaign_listener.onClick(f)}}catch(n){e.log("popup_listener.onClick error",n)}if("close"===p.type)i.destory();else if(p.closeable&&i.destory(),"auto"===e.info.popup_listener.openlink&&"openlink"===p.type){if("http"!==p.value.slice(0,4))return!1;window.location.href=p.value}}};var r=e.log;e.changeCovertStatus=function(n){var i=JSON.parse(JSON.stringify(e.convertPlans));t.each(i,function(i,a){if(!i.is_in_convert_window)return!1;var o=i.is_in_convert_window.step,s=i.is_in_convert_window.uuid;if(e.convertPlans[a].is_in_convert_window.step=Math.min(2*o,6e5),!n)return!1;t.each(n,function(t){t.popup_display_uuid===s&&t.convert_time&&(r("--\u8f6c\u5316\u7a97\u53e3- \u76ee\u6807\u4e8b\u4ef6\u5df2\u7ecf\u5b8c\u6210 - \u6ee1\u8db3",e.convertPlans[a].plan_id),delete e.convertPlans[a].is_in_convert_window,e.convertPlans.splice(a,1))})}),e.updateDataAndSetListen.updateLocalData()},e.asyncConvert=function(n){var i=e.info.project,a=!1;if(!n&&0===e.convertPlans.length)return!1;n&&(t.each(e.convertPlans,function(e){e.plan_id===n.plan_id&&(a=!0)}),a||e.convertPlans.push(n)),function o(){if(t.isEmptyObject(e.localData)||!t.isArray(e.convertPlans)||0===e.convertPlans.length)return!1;var n=JSON.parse(JSON.stringify(e.convertPlans)),a=n[0].is_in_convert_window&&n[0].is_in_convert_window.step||5e3,s=[];if(t.each(n,function(t,n){return!!t.is_in_convert_window&&((new Date).getTime()>t.is_in_convert_window.expire_time?(r("--\u8f6c\u5316\u7a97\u53e3\u8d85\u65f6\u5df2\u7ecf\u8fc7\u671f - \u6ee1\u8db3",e.convertPlans[n].plan_id),delete e.convertPlans[n].is_in_convert_window,e.convertPlans.splice(n,1),e.updateDataAndSetListen.updateLocalData(),!1):(s.push(t.is_in_convert_window.uuid),t.is_in_convert_window.step||(t.is_in_convert_window.step=5e3,e.convertPlans[n].is_in_convert_window.step=5e3),void(a>t.is_in_convert_window.step&&(a=t.is_in_convert_window.step))))}),!s.length)return!1;e.asyncConvert.timer&&clearTimeout(e.asyncConvert.timer),e.asyncConvert.timer=setTimeout(function(){t.ajax({url:e.info.api_base_url+"/sfo/popup_displays?project="+encodeURIComponent(i)+"&popup_display_uuids="+encodeURIComponent(s)+"&time="+(new Date).getTime(),type:"GET",cors:!0,credentials:!1,contentType:"application/json",success:function(t){e.changeCovertStatus(t),o()},error:function(){e.changeCovertStatus(),o()}})},a)}()},e.ruleTime={getExpire:function(e,t){var n=t,i=Number(e.value)||0,a=Number(e.value)||0,o=String(e.unit).toLowerCase(),r=null,s={day:function(){return(r=new Date(n)).setHours(23),r.setMinutes(59),r.setSeconds(59),r.setMilliseconds(999),r=r.getTime()+864e5*(a-1)},week:function(){var e=(r=new Date(n)).getDay();0===e&&(e=7);var t=7-e;return r.setHours(23),r.setMinutes(59),r.setSeconds(59),r.setMilliseconds(999),r=r.getTime()+24*t*60*60*1e3+7*(a-1)*24*60*60*1e3},month:function(){var e=(r=new Date(n)).getMonth()+a;return e>=11?(r.setFullYear(r.getFullYear()+parseInt(e/12)),r.setMonth(e%12)):r.setMonth(e),r.setDate(1),r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0),r.getTime()},second:function(e){var t={month:2592e6,week:6048e5,day:864e5,hour:36e5,minute:6e4,second:1e3},a=null;return r=new Date(n),e in t&&(a=t[e]*i),r.getTime()+a}};return!0!==e.natural?s.second(o):o in s?s[o]():void 0},getLast:function(e,t){var n=Number(e.value)||0,i=Number(e.value)-1||0,a=String(e.unit).toLowerCase(),o=null,r={day:function(){return(o=new Date(t)).setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0),o=o.getTime()-864e5*i},week:function(){var e=(o=new Date(t)).getDay();return 0===e&&(e=7),--e,o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0),o=o.getTime()-(24*e*60*60*1e3+7*i*24*60*60*1e3)},month:function(){var e=(o=new Date(t)).getMonth()+1-i;return e<=0?(o.setFullYear(o.getFullYear()+(parseInt(e/12)-1)),o.setMonth(12+e%12-1)):o.setMonth(e-1),o.setDate(1),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0),o.getTime()},second:function(e){var i={month:2592e6,week:6048e5,day:864e5,hour:36e5,minute:6e4,second:1e3},a=null;return o=new Date(t),e in i&&(a=i[e]*n),o.getTime()-a}};return!0!==e.natural?r.second(a):a in r?r[a]():void 0},getArrMatchCount:function(e,t){var n=0;for(n=0;n<e.length;n++)if(t>=e[n])return n;return e.length}},e.eventTriggerProcess=function(){if(!e.updateDataAndSetListen.active_state)return!1;if(!t.isArray(e.localData.eventQueue))return!1;if(0===e.localData.eventQueue.length)return!1;if(e.isRun)return!1;r("\u4e8b\u4ef6\u961f\u5217---eventQueue",e.localData.eventQueue);var n=!1,i=e.localData.eventQueue[0],a=e.eventRule[i.event];e.isRun=!0,e.localData.eventQueue.shift(),e.updateDataAndSetListen.updateLocalData(),t.isArray(a)&&t.isObject(a[0])&&a.length>0&&(r("--------------------\u89e6\u53d1\u4e8b\u4ef6\u5f00\u59cb--------------------"),t.each(a,function(n){t.isObject(n)&&"undefined"!=typeof n.match_state&&delete n.match_state,new e.RuleCheck(n,i)}),t.each(a,function(t){!0===t.match_state?!1===n?(n=!0,r("\u68c0\u67e5\u5b8c\u6bd5-\u4f18\u5148\u5f39\u7a97-\u5f00\u59cb",t.plan.cname),new e.PopupCheck(t,!0)):!0===n&&(r("\u68c0\u67e5\u5b8c\u6bd5-\u975e\u4f18\u5148\u5f39\u7a97-\u4e0d\u6e32\u67d3",t.plan.cname),new e.PopupCheck(t,!1)):r("\u68c0\u67e5\u5b8c\u6bd5-\u8ba1\u5212-\u4e0d\u6ee1\u8db3",t.plan.cname)}),n||e.completeWindowLifecycle(),r("--------------------\u89e6\u53d1\u4e8b\u4ef6\u7ed3\u675f--------------------"))},e.completeWindowLifecycle=function(){e.isRun=!1,e.eventTriggerProcess()},e.PopupCheck=function(t,n){this.plan=t.plan,this.current_time=(new Date).getTime(),n?this.renderPopup():this.hidePopup(),e.updateDataAndSetListen.updateLocalData()},e.PopupCheck.prototype.createPopupWindow=function(t,n){this.startConvertWindow(t),this.startPopupIntervalWindow(this.current_time),this.startPopupLimitWindow(),this.setGlobalLimit(),this.deletePlanAllWindow(),n&&e.completeWindowLifecycle()},e.PopupCheck.prototype.hidePopup=function(){this.deletePlanAllWindow()},e.PopupCheck.prototype.renderPopup=function(){e.handlerCampaign(this)},e.PopupCheck.prototype.popupFailed=function(n,i,a){var o={1001:"\u9884\u89c8\u4fe1\u606f\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8ba1\u5212\u914d\u7f6e",1003:"\u5bf9\u7167\u7ec4",1004:"campaignShouldStart \u63a5\u53e3\u8fd4\u56de false",1005:"\u8ba1\u5212\u4e0b\u53d1 is_trigger \u4e3a false",1006:"\u81ea\u5b9a\u4e49\u89e6\u8fbe\u8ba1\u5212\u672a\u5b9e\u73b0\u5f39\u7a97\u751f\u547d\u5468\u671f\u56de\u8c03"}[n],r=e.getPopupInfo(a.content);r.$sf_msg_id=a.uuid,r.plan=a.plan,r.$sf_succeed=!1,r.$sf_fail_reason=o,e.track.popupDisplay(r),!i&&e.info.popup_listener&&t.isFunction(e.info.popup_listener.onLoadFailed)&&e.info.popup_listener.onLoadFailed(a.plan.plan_id,n,o),e.info.popup_campaign_listener.onFailed(e.getSFCampaign(a.plan),n,o),this.createPopupWindow(a.uuid,!0)},e.PopupCheck.prototype.customCampaign=function(t){var n=e.getSFCampaign(t.plan),i=e.getPopupInfo(t.content);i.$sf_msg_id=t.uuid,i.plan=t.plan,i.$sf_succeed=!0,e.track.popupDisplay(i),e.info.popup_campaign_listener.onStart(n),this.createPopupWindow(t.uuid,!0)},e.PopupCheck.prototype.showPopup=function(n){if(!e.ElementRender)return e.log("\u6682\u4e0d\u652f\u6301\u9884\u7f6e\u5f39\u7a97UI"),!1;var i=new e.ElementRender(n.content),a=e.getPopupInfo(n.content);if(a.$sf_msg_id=n.uuid,a.plan=n.plan,a.$sf_succeed=!0,t.extend(i.msg,a),i.popupCheckInstance=this,e.track.popupDisplay(a),!i.render())return r("\u5f53\u524d\u9875\u9762\u5df2\u6709\u4e00\u4e2a\u5f39\u6846\u6b63\u5728\u6e32\u67d3\uff0c\u672c\u6b21\u5f39\u6846\u4e0d\u6e32\u67d3\uff01"),!1;e.info.popup_campaign_listener.onStart(e.getSFCampaign(n.plan)),this.createPopupWindow(n.uuid),e.info.popup_listener.onLoadSuccess(n.plan.plan_id)},e.PopupCheck.prototype.startConvertWindow=function(n){r("--\u5f39\u7a97\u5c55\u793a-\u8f6c\u5316\u7a97\u53e3\u8bbe\u7f6e",this.plan.cname),t.isObject(this.plan.convert_window)&&this.plan.convert_window.value&&(this.plan.is_in_convert_window={expire_time:e.ruleTime.getExpire(this.plan.convert_window,this.current_time),start_time:this.current_time,uuid:n},e.asyncConvert(this.plan))},e.PopupCheck.prototype.startPopupIntervalWindow=function(n){t.isObject(this.plan.popup_interval)&&this.plan.popup_interval.value&&(this.plan.is_in_popup_interval_window=e.ruleTime.getExpire(this.plan.popup_interval,n))},e.PopupCheck.prototype.resetPopupIntervalWindow=function(){var t=(new Date).getTime();this.startPopupIntervalWindow(t),this.resetGlobalLimit(t),e.completeWindowLifecycle()},e.PopupCheck.prototype.startPopupLimitWindow=function(){r("--\u5f39\u7a97\u5c55\u793a-\u53c2\u4e0e\u9650\u5236\u7a97\u53e3\u8bbe\u7f6e\u91cd\u7f6e"),t.isObject(this.plan.re_enter)&&this.plan.re_enter.value&&(t.isObject(this.plan.is_in_popup_limit_window)?this.plan.is_in_popup_limit_window.count++:this.plan.is_in_popup_limit_window={expire_time:e.ruleTime.getExpire(this.plan.re_enter,this.current_time),count:1})},e.PopupCheck.prototype.setGlobalLimit=function(){r("--\u5f39\u7a97\u5c55\u793a-\u5168\u5c40\u5f39\u7a97\u6b21\u6570\u8bbe\u7f6e"),t.isArray(e.localData.global_popup_count)||(e.localData.global_popup_count=[]),e.localData.global_popup_count.unshift(this.current_time);for(var n=e.localData.global_popup_count,i=n[n.length-1];i+7776e6<this.current_time||n.length>3e3;)n.pop(),i=n[n.length-1]},e.PopupCheck.prototype.resetGlobalLimit=function(n){t.isArray(e.localData.global_popup_count)&&e.localData.global_popup_count.length>0&&(e.localData.global_popup_count.shift(),e.localData.global_popup_count.unshift(n))},e.PopupCheck.prototype.deletePlanAllWindow=function(){var e=this.plan.pattern_popup.matcher_list;t.isArray(e)&&t.each(e,function(e){e.is_in_window&&(r("--\u5f39\u7a97\u5c55\u793a-\u91cd\u7f6e\u5404\u4e2a\u89c4\u5219\u7684\u7a97\u53e3\u8ba1\u7b97-\u6210\u529f"),delete e.is_in_window)})},e.RuleCheck=function(n,i){this.plan_match=n,this.plan=n.plan,this.rule_arr=n.rule,this.event_data=i,this.current_time=(new Date).getTime();var a="-------------\u68c0\u67e5-\u8ba1\u5212-("+this.plan.cname+")";t.each(this.rule_arr,function(e){a+="--\u5305\u542b\u89c4\u5219-("+e.event_name+"\uff09-\u89e6\u53d1"+e.params[0]+"\u6b21"}),r(a),r(this.plan),this.checkPlanIsExpire(),e.updateDataAndSetListen.updateLocalData()},e.RuleCheck.prototype.checkPlanIsExpire=function(){!this.plan.expire_at||t.isNumber(this.plan.expire_at)&&this.current_time<this.plan.expire_at?(r("--\u8fc7\u671f-\u6ee1\u8db3",this.plan.cname),this.checkPlanIsAudience()):r("--\u8fc7\u671f-\u4e0d\u6ee1\u8db3",this.plan.cname)},e.RuleCheck.prototype.checkPlanIsAudience=function(){!0===this.plan.is_audience?(r("--\u662f\u5426\u53d7\u4f17-\u6ee1\u8db3",this.plan.cname),this.checkPlanSuspend()):r("--\u662f\u5426\u53d7\u4f17-\u4e0d\u6ee1\u8db3",this.plan.cname)},e.RuleCheck.prototype.checkPlanSuspend=function(){this.plan.status&&"SUSPEND"===this.plan.status?r("--\u6682\u505c-\u4e0d\u6ee1\u8db3",this.plan.cname):(r("--\u6682\u505c-\u6ee1\u8db3",this.plan.cname),this.checkPlanIsOnlineTime())},e.RuleCheck.prototype.checkPlanIsOnlineTime=function(){var e,n,i;function a(e,t){var n=new Date,i=n.getDay(),a=n.getDate()-(0===i?7:i);return n.setDate(a+e),n.setHours(Number(t.split(":")[0])),n.setMinutes(Number(t.split(":")[1])),n}function o(){var e=new Date;return Number(e.getHours()+"."+e.getMinutes())}if(t.isObject(this.plan.display_time_config)&&t.isObject(this.plan.display_time_config.natural_repeat_cycle)&&t.isArray(this.plan.display_time_config.natural_repeat_cycle.time_ranges)&&t.isObject(this.plan.display_time_config.natural_repeat_cycle.time_ranges[0])&&this.plan.display_time_config.natural_repeat_cycle.time_ranges[0].start_time&&this.plan.display_time_config.natural_repeat_cycle.time_ranges[0].end_time)if("DAY"===this.plan.display_time_config.natural_repeat_cycle.repeat_cycle){e=this.plan.display_time_config.natural_repeat_cycle.time_ranges;for(var s=0;s<e.length;s++){if(!t.isString(e[s].start_time)||!t.isString(e[s].end_time))return r("--\u4e0a\u7ebf\u65f6\u95f4\u6bb5\u53c2\u6570\u4e0d\u5408\u6cd5\u6240\u4ee5\u4e0d\u4f1a\u8ba1\u7b97-\u6ee1\u8db3",this.plan.cname),this.checkConvert(),!1;if((i=Number(e[s].start_time.replace(":",".")))>=(n=Number(e[s].end_time.replace(":",".")))){if(o()>i||o()<n)return r("--\u4e0a\u7ebf\u65f6\u95f4\u6bb5\u8de8\u65e5-\u6ee1\u8db3",this.plan.cname),this.checkConvert(),!0;r("--\u4e0a\u7ebf\u65f6\u95f4\u6bb5\u8de8\u65e5-\u4e0d\u6ee1\u8db3",this.plan.cname)}else{if(o()>i&&o()<n)return this.checkConvert(),r("--\u4e0a\u7ebf\u65f6\u95f4\u6bb5\u540c\u65e5-\u6ee1\u8db3",this.plan.cname),!0;r("--\u4e0a\u7ebf\u65f6\u95f4\u6bb5\u540c\u65e5-\u4e0d\u6ee1\u8db3",this.plan.cname)}}}else{if("WEEK"===this.plan.display_time_config.natural_repeat_cycle.repeat_cycle){e=this.plan.display_time_config.natural_repeat_cycle.time_ranges;for(s=0;s<e.length;s++){if(!(t.isString(e[s].start_time)&&t.isString(e[s].end_time)&&t.isNumber(e[s].day)))return r("--\u4e0a\u7ebf\u65f6\u95f4\u6bb5\u53c2\u6570\u4e0d\u5408\u6cd5\u6240\u4ee5\u4e0d\u4f1a\u8ba1\u7b97-\u6ee1\u8db3",this.plan.cname),this.checkConvert(),!1;i=Number(e[s].start_time.replace(":",".")),n=Number(e[s].end_time.replace(":","."));var p=e[s].day,l=new Date;if(i>n&&(p+=1),a(e[s].day,e[s].start_time)<l&&l<a(p,e[s].end_time))return r("--\u4e0a\u7ebf\u65f6\u95f4\u6bb5\u5468\u7ea7-\u6ee1\u8db3",this.plan.cname),this.checkConvert(),!0}return r("--\u4e0a\u7ebf\u65f6\u95f4\u5468\u7ea7-\u4e0d\u6ee1\u8db3",this.plan.cname),!1}r("--\u4e0a\u7ebf\u65f6\u95f4\u6bb5\u53c2\u6570\u4e0d\u5408\u6cd5\u6240\u4ee5\u4e0d\u4f1a\u8ba1\u7b97-\u6ee1\u8db3",this.plan.cname)}else r("--\u4e0a\u7ebf\u65f6\u95f4\u6bb5\u53c2\u6570\u4e0d\u5408\u6cd5\u6240\u4ee5\u4e0d\u4f1a\u8ba1\u7b97-\u6ee1\u8db3",this.plan.cname),this.checkConvert()},e.RuleCheck.prototype.checkConvert=function(){if(t.isObject(this.plan.is_in_convert_window)&&this.plan.is_in_convert_window.expire_time>this.current_time)r("--\u5b58\u5728\u8f6c\u5316\u7a97\u53e3 - \u4e0d\u6ee1\u8db3",this.plan.is_in_convert_window);else if(t.isObject(this.plan.is_in_convert_window)&&this.current_time>this.plan.is_in_convert_window.expire_time){r("--\u8f6c\u5316\u7a97\u53e3\u8d85\u65f6\u5df2\u7ecf\u8fc7\u671f - \u6ee1\u8db3",this.plan.plan_id),delete this.plan.is_in_convert_window;for(var n=0;n<e.convertPlans.length;n++)this.plan.plan_id===e.convertPlans[n].plan_id&&(e.convertPlans.splice(n,1),n--);this.checkGlobalPopupInterval()}else r("--\u4e0d\u5b58\u5728\u8f6c\u5316\u7a97\u53e3 - \u6ee1\u8db3",this.plan.is_in_convert_window),this.checkGlobalPopupInterval()},e.RuleCheck.prototype.checkGlobalPopupInterval=function(){var n=e.localData.global_popup_count;if(t.isArray(n)&&n.length>=1){var i=e.ruleTime.getLast(e.localData.popup_interval_global,this.current_time);i>n[0]?(r("--\u5168\u5c40\u5f39\u7a97\u95f4\u9694-\u6ee1\u8db3-"+i+">\u4e0a\u6b21\u5f39\u7a97\u65f6\u95f4"+n[0]),this.checkPopupInterval()):r("\u68c0\u67e5-\u5168\u5c40\u5f39\u7a97\u95f4\u9694-\u4e0d\u6ee1\u8db3-"+i+"<\u4e0a\u6b21\u5f39\u7a97\u65f6\u95f4"+n[0])}else r("--\u5168\u5c40\u5f39\u7a97\u95f4\u9694-\u6ca1\u6709\u5f39\u8fc7\u7a97-\u6ee1\u8db3"),this.checkPopupInterval()},e.RuleCheck.prototype.checkPopupInterval=function(){var e=!0;t.isNumber(this.plan.is_in_popup_interval_window)?this.current_time>this.plan.is_in_popup_interval_window?(r("--\u5f39\u7a97\u95f4\u9694-\u5f53\u524d\u65f6\u95f4\u5927\u4e8e\u56fa\u5b9a\u5f39\u7a97\u95f4\u9694-\u6ee1\u8db3"),this.plan.is_in_popup_interval_window=null):(r("--\u5f39\u7a97\u95f4\u9694-\u5f53\u524d\u65f6\u95f4\u5c0f\u4e8e\u56fa\u5b9a\u5f39\u7a97\u95f4\u9694-\u4e0d\u6ee1\u8db3"),e=!1):(r("--\u5f39\u7a97\u95f4\u9694-\u7a97\u53e3\u4e0d\u5b58\u5728-\u65b0\u5f00"),this.plan.is_in_popup_interval_window=null),e&&this.checkPermission()&&this.checkProperties()},e.RuleCheck.prototype.isMatched=function(e){var n={equal:function(e,n){if(!t.isNumber(e)&&!t.isString(e))return!1;for(var i=0,a=n.length;i<a;i++){if(!t.isNumber(n[i])&&!t.isString(n[i]))return!1;if(t.isString(e)){if(e===(t.isString(n[i])?n[i]:String(n[i])))return!0}else if(t.getConvertNumberValue(e)===t.getConvertNumberValue(n[i]))return!0}return!1},notEqual:function(e,n){if(!t.isNumber(e)&&!t.isString(e))return!1;for(var i=0,a=n.length;i<a;i++){if(!t.isNumber(n[i])&&!t.isString(n[i]))return!1;if(t.isString(e)){if(e===(t.isString(n[i])?n[i]:String(n[i])))return!1}else if(t.getConvertNumberValue(e)===t.getConvertNumberValue(n[i]))return!1}return!0},contain:function(e,n){return!!t.isString(e)&&e.indexOf(n[0])>=0},notContain:function(e,n){return!!t.isString(e)&&-1===e.indexOf(n[0])},isTrue:function(e){return!0===e},isFalse:function(e){return!1===e},isSet:function(e){return void 0!==e},notSet:function(e){return void 0===e},isEmpty:function(e){if(!t.isString(e)&&!t.isArray(e))return!1;if(t.isString(e))return""===e;for(var n=0;n<e.length;n++){if(""!==e[n].replace(/^\s+|\s+$/g,""))return!1}return!0},isNotEmpty:function(e){if(!t.isString(e)&&!t.isArray(e))return!1;if(t.isString(e))return""!==e;for(var n=0;n<e.length;n++){if(""===e[n].replace(/^\s+|\s+$/g,""))return!1}return!0},less:function(e,n){return!!t.isNumber(e)&&("undefined"!=typeof n[0]&&t.getConvertNumberValue(e)<t.getConvertNumberValue(n[0]))},greater:function(e,n){return!!t.isNumber(e)&&("undefined"!=typeof n[0]&&t.getConvertNumberValue(e)>t.getConvertNumberValue(n[0]))},between:function(e,n){if(!t.isNumber(e))return!1;if("undefined"==typeof n[0]&&"undefined"==typeof n[1])return!1;var i=t.getConvertNumberValue(e),a=t.getConvertNumberValue(n[0]),o=t.getConvertNumberValue(n[1]);return i>=a&&i<=o},isIn:function(e,n){if(!t.isArray(e))return!1;for(var i=0;i<e.length;i++)if(t.indexOf(n,e[i])>=0)return!0;return!1},notInclude:function(e,n){if(!t.isArray(e))return!1;for(var i=0;i<e.length;i++)if(-1===t.indexOf(n,e[i]))return!0;return!1},absolute_between:function(e,t){try{var n=new Date(t[0]),i=new Date(t[1]),a=new Date(e);return a>=n&&a<=i}catch(o){r("absolute_between Error",o)}},absoluteBetween:function(e,t){try{var n=new Date(t[0]),i=new Date(t[1]),a=new Date(e);return a>=n&&a<=i}catch(o){r("absolute_between Error",o)}}},i=this,a=e.relation,o="or"===String(a).toLowerCase(),s="and"===String(a).toLowerCase(),p=!!s,l=!0;return t.each(e.conditions,function(e){if(!l)return!1;if(!e.field)return!1;var t=e.field.lastIndexOf("."),a=e.params,r="in"===e["function"]?"isIn":e["function"];if(!n[r])return p=!1,l=!1,!1;if(t<0)return!1;var c=e.field.slice(t+1),u=i.event_data.properties,_=u[c];"$event_duration"===c&&void 0===_&&(_=u.event_duration);var d=n[r](_,a);o&&d&&(p=!0,l=!1),s&&!d&&(p=!1,l=!1)}),p},e.RuleCheck.prototype.checkProperties=function(){var e=this,n=t.filter(this.rule_arr,function(t){var n=t.multi_filter?t.multi_filter:t.filter;return!(n&&(!n.conditions||0!==n.conditions.length))||e.isMatched(n)});t.isArray(n)&&n.length>0?(this.checkWindowAndMatch(n),r("--\u5c5e\u6027\u5339\u914d-\u6ee1\u8db3",n)):r("--\u5c5e\u6027\u5339\u914d-\u4e0d\u6ee1\u8db3")},e.RuleCheck.prototype.checkPermission=function(){var n=this.plan.event_permission;if(!t.isObject(n)||t.isEmptyObject(n))return!0;var i=this,a=[],o=function(e){return t.filter(e,function(e){return!(e&&e.conditions&&(!e.conditions||0!==e.conditions.length))||i.isMatched(e)})};return function r(e){t.each(e,function(e){if(a=o([e]),t.isArray(a)&&a.length>0){var n=e.filters||[];n&&n.length>0&&r(n)}})}([n]),t.isArray(a)&&a.length>0?(e.log("--\u89d2\u8272\u5c5e\u6027\u5339\u914d-\u6ee1\u8db3",a),!0):(e.log("--\u89d2\u8272\u5c5e\u6027\u5339\u914d-\u4e0d\u6ee1\u8db3"),!1)},e.RuleCheck.prototype.checkWindowAndMatch=function(n){var i=this,a=[];t.each(n,function(n){if(!n.params||!n.params[0])return r("--\u7a97\u53e3\u671f\u548c\u6b21\u6570-\u89c4\u5219\u6570\u636e\u5f02\u5e38"),!1;var o=Number(n.params[0]);1===o?a.push(n):o>1&&t.isObject(n.window)&&n.window.value>0&&(!t.isObject(n.is_in_window)||!t.isNumber(n.is_in_window.expire_time)||n.is_in_window.expire_time<i.current_time?n.is_in_window={expire_time:e.ruleTime.getExpire(n.window,i.current_time),count:1}:n.is_in_window.count=n.is_in_window.count+1,n.is_in_window.count>=o?a.push(n):r("--\u7a97\u53e3\u671f\u548c\u6b21\u6570-\u89c4\u5219\u6570",n.is_in_window.count,"\u4e0d\u5339\u914d\u5f53\u524d\u6b21\u6570",o))}),a.length>0?(r("--\u7a97\u53e3\u671f\u548c\u6b21\u6570-\u6709\u5339\u914d\u6210\u529f\u7684\u89c4\u5219",a),this.checkGlobalPopupLimit()):r("--\u7a97\u53e3\u671f\u548c\u6b21\u6570-\u6ca1\u6709\u5339\u914d\u6210\u529f\u7684\u89c4\u5219",a)},e.RuleCheck.prototype.checkGlobalPopupLimit=function(){var n=e.localData.msg_limit_global,i=!0,a=this;t.isObject(n)&&!0===n.is_in_use&&t.isArray(n.limits)&&t.isArray(e.localData.global_popup_count)&&!0===this.plan.global_msg_limit_enabled?(t.each(n.limits,function(n){if(t.isObject(n)&&t.isNumber(n.limit)){var o=e.ruleTime.getLast(n,a.current_time),s=e.ruleTime.getArrMatchCount(e.localData.global_popup_count,o);r("--\u5168\u5c40\u5f39\u7a97\u9650\u5236-\u5df2\u7ecf\u5f39\u7a97\u6b21\u6570-"+s+"-\u9650\u5236\u7684\u6b21\u6570"+n.limit+"-\u9650\u5236\u65f6\u95f4-"+o),i=s<n.limit?i&&!0:i&&!1}}),i?(r("--\u5168\u5c40\u5f39\u7a97\u9650\u5236- \u6ee1\u8db3"),this.checkPopupLimit()):r("--\u5168\u5c40\u5f39\u7a97\u9650\u5236-\u4e0d\u6ee1\u8db3")):(r("--\u5168\u5c40\u5f39\u7a97\u9650\u5236- \u6ee1\u8db3"),this.checkPopupLimit())},e.RuleCheck.prototype.checkPopupLimit=function(){if(!t.isObject(this.plan.re_enter)||!t.isNumber(this.plan.re_enter.value)||!t.isNumber(this.plan.re_enter.limit))return this.plan_match.match_state=!0,!1;t.isObject(this.plan.is_in_popup_limit_window)&&t.isNumber(this.plan.is_in_popup_limit_window.expire_time)&&t.isNumber(this.plan.is_in_popup_limit_window.count)?this.plan.is_in_popup_limit_window.expire_time<this.current_time?(r("--\u53c2\u4e0e\u9650\u5236-\u8d85\u8fc7\u4e86\u53c2\u4e0e\u9650\u5236\u7a97\u53e3-\u5f00\u542f\u65b0\u7a97\u53e3-\u6ee1\u8db3",this.plan.is_in_popup_limit_window),delete this.plan.is_in_popup_limit_window,this.plan_match.match_state=!0):this.plan.is_in_popup_limit_window.count<this.plan.re_enter.limit?(r("--\u53c2\u4e0e\u9650\u5236-\u5728\u7a97\u53e3\u5185\u4e14\u5728\u53c2\u4e0e\u9650\u5236\u6b21\u6570\u5185-\u6ee1\u8db3",this.plan.is_in_popup_limit_window),this.plan_match.match_state=!0):r("--\u53c2\u4e0e\u9650\u5236-\u5728\u7a97\u53e3\u5185\u4f46\u662f\u8d85\u8fc7\u4e86\u53c2\u4e0e\u9650\u5236-\u4e0d\u6ee1\u8db3",this.plan.is_in_popup_limit_window):(this.plan.is_in_popup_limit_window?(r("--\u53c2\u4e0e\u9650\u5236-\u6709\u7a97\u53e3\u4f46\u662f\u7a97\u53e3\u6570\u636e\u5f02\u5e38-\u5f00\u65b0\u7a97\u53e3-\u6ee1\u8db3",this.plan.is_in_popup_limit_window),delete this.plan.is_in_popup_limit_window):r("--\u53c2\u4e0e\u9650\u5236-\u4e0d\u5b58\u5728\u7a97\u53e3-\u5f00\u65b0\u7a97\u53e3-\u6ee1\u8db3",this.plan.is_in_popup_limit_window),this.plan_match.match_state=!0)};var s="dfm-enc-";function p(e){var t="t6KJCZa5pDdQ9khoEM3Tj70fbP2eLSyc4BrsYugARqFIw1mzlGNVXOHiWvxUn8",n=t.length-1,i={},a=0;for(a=0;a<t.length;a++)i[t.charAt(a)]=t.charAt(n-a);var o="";for(a=0;a<e.length;a++)e.charAt(a)in i?o+=i[e.charAt(a)]:o+=e.charAt(a);return o}function l(){if(!e.isSupportPopup())return!1;if(window.screen.width&&Number(window.screen.width)>1024)return"object"==typeof console&&console.log&&console.log("H5 \u5f39\u7a97\u4ec5\u652f\u6301\u79fb\u52a8\u7aef\u548c ipad\uff0c\u6216\u8005\u5c4f\u5e55\u5bbd\u5ea6\u5c0f\u4e8e\u7b49\u4e8e 1024\u3002"),!1;var n={};return arguments.length>0&&(1===arguments.length&&t.isObject(arguments[0])?n=arguments[0]:arguments.length>=2&&t.isObject(arguments[1])&&(n=arguments[1])),!!this.setPara(n)&&(e.info.platform="H5",!!e.setIsLoad()&&(!!this.getBridgeState()&&void(e.testSend.hasParam()?e.testSend.start():(e.listenPageStateChange(),e.updateDataAndSetListen.initial()))))}return e.store={delete_time:2592e6,init:function(){this.migrateLocalData(),e.localData=this.getLocalData(),t.isNumber(e.localData.config_pull_interval_ms)&&e.localData.config_pull_interval_ms>0&&(e.updateDataAndSetListen.interval_time=e.localData.config_pull_interval_ms),this.removeLocalData(),e.log("\u521d\u59cb\u5316-\u83b7\u53d6-\u5185\u5b58-localData")},getJSONData:function(){var n,i=t.localStorage.get(e.config.storageName);t.isString(i)&&(0===(n=i).indexOf(s)&&(n=p(n=n.substring(s.length))),i=n);try{i=JSON.parse(i)}catch(a){t.log(a)}return i},saveJSONData:function(n){n=JSON.stringify(n),e.info.encrypt_cookie&&(n=s+p(n)),t.localStorage.set(e.config.storageName,n)},migrateLocalData:function(){var t=this.getJSONData()||{},n=e.sa.store.getDistinctId();if(t.popup_sdk_users&&t.popup_sdk_plans)return!1;var i={popup_sdk_plans:{},popup_sdk_users:{}};i.popup_sdk_plans[n]=t,i.popup_sdk_users[n]={user_id:n},this.saveJSONData(i)},getLocalData:function(){var n=this.getJSONData(),i=e.sa.store.getDistinctId(),a=null;return n?(t.isObject(n.popup_sdk_users[i])&&n.popup_sdk_users[i].user_id&&(a=n.popup_sdk_users[i].user_id),a&&t.isObject(n.popup_sdk_plans[a])?(n.popup_sdk_plans[a].update_time=(new Date).getTime(),this.saveJSONData(n),n.popup_sdk_plans[a]):{}):{}},saveLocalData:function(){var n=this.getJSONData(),i=e.sa.store.getDistinctId(),a=null;if(!n)return!1;n.popup_sdk_users&&t.isObject(n.popup_sdk_users[i])&&n.popup_sdk_users[i].user_id&&(a=n.popup_sdk_users[i].user_id,n.popup_sdk_plans[a]=e.localData,this.saveJSONData(n))},removeLocalData:function(){var e=this.getJSONData(),n=this.delete_time;if(!e||!e.popup_sdk_plans||!e.popup_sdk_users)return!1;var i=JSON.parse(JSON.stringify(e.popup_sdk_plans)),a=JSON.parse(JSON.stringify(e.popup_sdk_users)),o=(new Date).getTime(),r=[];t.each(i,function(t,i){o-t.update_time>n&&(delete e.popup_sdk_plans[i],r.push(i))}),t.each(a,function(n,i){r.length>0&&t.each(r,function(t){n.user_id&&t===n.user_id&&delete e.popup_sdk_users[i]})}),this.saveJSONData(e)}},e.updateDataAndSetListen={active_state:!0,interval_time:6e5,save_interval:null,data_interval:null,image_list:null,local_data:null,filterConvertPlans:function(){var n=e.localData.popup_plans;if(!n||!t.isArray(n))return!1;var i=t.filter(n,function(e){return!!e.convert_window&&!!e.is_in_convert_window});e.convertPlans=i,e.log("\u521d\u59cb\u5316-\u5f02\u6b65\u7684convertWindow",e.convertPlans),e.asyncConvert()},diffData:function(){var n=e.localData,i=JSON.parse(JSON.stringify(e.serverData));(new Date).getTime();if(!i||t.isEmptyObject(i))return!1;if(!n||t.isEmptyObject(n)||!n.popup_plans||0===n.popup_plans.length)return t.extend(e.localData,i),!1;var a=i.popup_plans;t.each(a,function(i,o){var r=null;if(t.each(n.popup_plans,function(n){n.plan_id===i.plan_id&&(r=n,i.audience_id||delete r.audience_id,t.isObject(i.window_update)&&t.each(i.window_update,function(t,n){r.window_update&&r.window_update[n]===t||("trigger_window"===n?r.pattern_popup.matcher_list=i.pattern_popup.matcher_list:"convert_window"===n&&r.is_in_convert_window&&i.convert_window&&r.is_in_convert_window.start_time&&(r.is_in_convert_window.expire_time=e.ruleTime.getExpire(i.convert_window,r.is_in_convert_window.start_time)))}))}),!r)return!1;if(!i.window_update&&r.last_update_config_time!==i.last_update_config_time)return!1;var s=r.pattern_popup.matcher_list;t.extend2Lev(r,i),r.pattern_popup.matcher_list=s,a[o]=r}),t.extend(e.localData,i)},getEventRule:function(){var n=e.localData.popup_plans,i={};if(!n||!t.isArray(n))return!1;t.each(n,function(e){var n=e.pattern_popup.matcher_list;t.each(n,function(n){var a={plan:e,rule:[n]},o=n.event_name,r=!1;if(i[o]){if(t.each(i[o],function(t){t.plan.plan_id===e.plan_id&&(t.rule.push(n),r=!0)}),r)return!1;i[o].push(a)}else i[o]=[a]})}),t.each(i,function(e){e.sort(function(e,t){var n=t.plan.absolute_priority-e.plan.absolute_priority;return 0===n?t.plan.plan_id-e.plan.plan_id:n})}),e.eventRule=i,e.log("\u521d\u59cb\u5316-\u5f97\u5230\u4e8b\u4ef6\u548c\u8ba1\u5212\u7684\u5173\u7cfb"),e.log("--------------------\u521d\u59cb\u5316\u5b8c\u6210--------------------\u7b49\u5f85\u4e8b\u4ef6\u89e6\u53d1\u8ba1\u5212--------------------")},registerListen:function(){var n=this;e.sa.events.on("send",function(i){i.event&&e.eventRule[i.event]&&(t.isArray(e.localData.eventQueue)||(e.localData.eventQueue=[]),e.localData.eventQueue.push(i),n.updateLocalData(),e.eventTriggerProcess())}),e.sa.events.on("changeDistinctId",function(e){n.changeId()}),e.sa.events.isReady()},setListenEvent:function(){this.diffData(),this.filterConvertPlans(),this.getEventRule(),this.updateLocalData()},loadImage:function(e){if(e.length<1)return!1;if(JSON.stringify(e)===JSON.stringify(this.image_list))return!1;this.image_list=e;for(var t=0;t<e.length;t++)n=e[t],void 0,(new Image).src=n;var n},getDataFromServer:function(n,i){var a=this,o=encodeURIComponent(e.sa.store.getDistinctId()),r=encodeURIComponent(e.info.platform),s=encodeURIComponent(e.info.project);n=t.isFunction(n)?n:function(){},i=t.isFunction(i)?i:function(){},t.ajax({url:e.info.api_base_url+"/sfo/user_popup_configs?distinct_id="+o+"&platform="+r+"&project="+s+"&time="+(new Date).getTime()+"&sdk_version="+e.lib_version,type:"GET",cors:!0,credentials:!1,contentType:"application/json",success:function(o){if(!a.active_state)return i(),!1;e.log("\u521d\u59cb\u5316-\u4fee\u6539-serverData-ajax\u83b7\u53d6"),t.isObject(o)&&o.server_current_time&&o.popup_plans&&/\d+\.\d+/.test(o.min_sdk_version_required)&&parseFloat(o.min_sdk_version_required)<=parseFloat(e.lib_version)?(e.serverData=o,t.isNumber(o.config_pull_interval_ms)&&o.config_pull_interval_ms>0&&(a.interval_time=o.config_pull_interval_ms),e.serverData.local_update_time=(new Date).getTime(),e.info.preload_image&&a.loadImage(e.getImageList(o.popup_plans)),a.updateUserPlans(),a.setListenEvent()):(e.log("\u521d\u59cb\u5316-\u6570\u636e\u5f02\u5e38-\u8bf7\u6c42\u8fd4\u56de\u7684\u6570\u636e\u9519\u8bef-\u4e2d\u6b62"),e.serverData={},e.localData={},a.updateLocalData()),n(),a.setIntervalTime(a.interval_time)},error:function(){if(!a.active_state)return i(),!1;e.log("\u521d\u59cb\u5316-\u6570\u636e\u5f02\u5e38-\u8bf7\u6c42\u9519\u8bef-\u4e2d\u6b62"),e.serverData={},n(),a.setIntervalTime(a.interval_time)}})},updateUserPlans:function(){var t=e.store.getJSONData(),n=e.sa.store.getDistinctId(),i=e.serverData.user_id;t.popup_sdk_users[n]={user_id:i||n},i?t.popup_sdk_plans[i]?e.localData=t.popup_sdk_plans[i]:t.popup_sdk_plans[n]&&(e.localData=t.popup_sdk_plans[n],delete t.popup_sdk_plans[n]):t.popup_sdk_plans[n]&&(e.localData=t.popup_sdk_plans[n]),e.localData.update_time=(new Date).getTime(),e.store.saveJSONData(t)},setIntervalTime:function(t){var n=this;this.data_interval=setTimeout(function(){e.log("10\u5206\u949f\u5b9a\u65f6\u66f4\u65b0\u6570\u636e\u5f00\u59cb-------"),n.getDataFromServer()},t)},setFirstListen:function(){var e=this;this.getDataFromServer(function(){e.registerListen()})},updateLocalData:function(){var t=JSON.stringify(e.localData);this.local_data!==t&&(this.local_data=t,e.store.saveLocalData())},initial:function(){e.store.init();var n=e.localData.local_update_time,i=(new Date).getTime();if(t.isNumber(n)){var a=i-n;a<=0||a>=this.interval_time?this.setFirstListen():(this.setIntervalTime(this.interval_time-a),this.setListenEvent(),this.registerListen(),e.info.preload_image&&this.loadImage(e.getImageList(e.localData.popup_plans)))}else this.setFirstListen()},changeId:function(){this.stopAllState(),this.startState({getLocalData:!1})},stopAllState:function(){this.active_state=!1,e.eventRule={},this.data_interval&&window.clearTimeout(this.data_interval),this.save_interval&&window.clearInterval(this.save_interval),e.asyncConvert.timer&&window.clearTimeout(e.asyncConvert.timer),e.convertPlans=[],e.localData={},this.resetState()},resetState:function(){if("WEB"===e.info.platform)return!1;!document.querySelector("div[data-sf-mask]")&&e.isRun&&(e.isRun=!1)},startState:function(t){this.active_state=!0,(t=t||{getLocalData:!0}).getLocalData&&(this.resetState(),e.localData=e.store.getLocalData()),this.getDataFromServer()}},e.testSend={hasParam:function(){var e=t.URL(window.location.href).searchParams,n=e.get("sf_popup_test")||"",i=e.get("popup_window_id")||"",a=e.get("platform");return!(!n||!i)&&{sf_popup_test:n,popup_window_id:i,platform:a}},start:function(){var n=e.info.project,i=e.info.platform,a=this.hasParam().popup_window_id,o=this.hasParam().platform,r=encodeURIComponent(e.sa.store.getDistinctId());if("WEB"===o)return e.log("WEB\u7aef\u6d4b\u8bd5\u5f39\u7a97\u8bf7\u5728PC\u8bbe\u5907\u6253\u5f00\uff01"),!1;t.ajax({url:e.info.api_base_url+"/sfo/popup_windows/"+a+"?project="+encodeURIComponent(n)+"&time="+(new Date).getTime()+"&sdk_version="+e.lib_version+"&platform="+encodeURIComponent(i)+"&distinct_id="+r,type:"GET",credentials:!1,cors:!0,contentType:"application/json",success:function(n){var i,a=t.getUuid();t.isObject(n)||(e.sa.log("\u6d4b\u8bd5\u5f39\u7a97-\u670d\u52a1\u7aef\u6570\u636e\u683c\u5f0f\u4e0d\u5408\u6cd5",n),n={});try{i=JSON.parse(n.content)}catch(s){e.sa.log("\u6d4b\u8bd5\u5f39\u7a97-content\u89e3\u6790\u5931\u8d25,content:",n,s)}var o=e.getPopupInfo(i);o.$sf_msg_id=a;var r={content:n.content,type:n.popup_type||"PRESET"};(Object.hasOwnProperty.call(n,"name")&&(r.name=n.name),n.popup_type&&"CUSTOMIZED"===n.popup_type)?t.isString(n.content)?"withoutCampaignListener"===e.info.supportCustom||"withoutStart"===e.info.supportCustom?(o.$sf_succeed=!1,o.$sf_fail_reason="\u81ea\u5b9a\u4e49\u89e6\u8fbe\u8ba1\u5212\u672a\u5b9e\u73b0\u5f39\u7a97\u751f\u547d\u5468\u671f\u56de\u8c03",e.track.popupDisplay(o),e.info.popup_campaign_listener.onFailed(r,1006,"\u81ea\u5b9a\u4e49\u89e6\u8fbe\u8ba1\u5212\u672a\u5b9e\u73b0\u5f39\u7a97\u751f\u547d\u5468\u671f\u56de\u8c03")):(o.$sf_succeed=!0,e.track.popupDisplay(o),e.info.popup_campaign_listener.onStart(r)):(o.$sf_succeed=!1,o.$sf_fail_reason="\u9884\u89c8\u4fe1\u606f\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8ba1\u5212\u914d\u7f6e",e.track.popupDisplay(o),e.info.popup_campaign_listener.onFailed(r,1001,"\u9884\u89c8\u4fe1\u606f\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8ba1\u5212\u914d\u7f6e")):t.isObject(i)&&t.isObject(i.properties)&&t.isObject(i.template)?(new e.ElementRender(i).render(),o.$sf_succeed=!0,e.track.popupDisplay(o),e.info.popup_campaign_listener.onStart(r),e.info.popup_listener.onLoadSuccess()):(o.$sf_succeed=!1,o.$sf_fail_reason="\u9884\u89c8\u4fe1\u606f\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8ba1\u5212\u914d\u7f6e",e.track.popupDisplay(o),e.info.popup_listener.onLoadFailed("",1001,"\u9884\u89c8\u4fe1\u606f\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8ba1\u5212\u914d\u7f6e"),e.info.popup_campaign_listener.onFailed(r,1001,"\u9884\u89c8\u4fe1\u606f\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u8ba1\u5212\u914d\u7f6e"))},error:function(t){e.log("\u6d4b\u8bd5\u5f39\u7a97\u83b7\u53d6\u6570\u636e\u9519\u8bef",t)}})}},e.setPara=function(n){t.isObject(n)||(n={}),e.info=t.extend({},e.defaultPara,n);var i=e.sa;if(!i)return e.log("web js sdk \u8fd8\u6ca1\u6709\u521d\u59cb\u5316\u5b8c\u6210"),!1;if(!0===i.para.encrypt_cookie&&(e.info.encrypt_cookie=!0),!t.isString(e.info.api_base_url)||"http"!==e.info.api_base_url.slice(0,4))return e.log("popup \u5fc5\u987b\u586b\u5199\u6709\u6548 api_base_url"),!1;if("http:"===e.info.api_base_url.slice(0,5)&&"https:"===location.protocol)return e.log("\u60a8\u7684\u5f53\u524d\u9875\u9762\u662fhttps\u7684\u5730\u5740\uff0capi_base_url \u4e5f\u5fc5\u987b\u662fhttps\uff01"),!1;if(e.info.api_base_url="/"===e.info.api_base_url.slice(-1)?e.info.api_base_url.slice(0,-1):e.info.api_base_url,!t.isString(i.para.server_url)||"http"!==i.para.server_url.slice(0,4))return e.log("server_url \u5fc5\u987b\u586b\u5199\u6709\u6548\u6570\u636e\u63a5\u6536\u5730\u5740"),!1;if(e.info.project||(e.info.project=t.URL(i.para.server_url).searchParams.get("project")||"default"),t.isObject(e.info.popup_listener)){var a=e.info.popup_listener;t.isFunction(a.onClick)||(e.info.popup_listener.onClick=function(){}),t.isFunction(a.onLoadSuccess)||(e.info.popup_listener.onLoadSuccess=function(){}),t.isFunction(a.onLoadFailed)||(e.info.popup_listener.onLoadFailed=function(){}),t.isFunction(a.onClose)||(e.info.popup_listener.onClose=function(){}),t.isString(a.openlink)?"auto"!==a.openlink&&"customize"!==a.openlink&&(e.info.popup_listener.openlink="customize"):e.info.popup_listener.openlink="customize"}else e.info.popup_listener={onClick:function(){},onLoadSuccess:function(){},onLoadFailed:function(){},onClose:function(){},openlink:"customize"};return e.info.supportCustom=!0,t.isObject(e.info.popup_campaign_listener)?(t.isFunction(e.info.popup_campaign_listener.shouldStart)||(e.info.popup_campaign_listener.shouldStart=function(){return!0}),t.isFunction(e.info.popup_campaign_listener.onStart)||(e.info.supportCustom="withoutStart",e.info.popup_campaign_listener.onStart=function(){}),t.isFunction(e.info.popup_campaign_listener.onEnd)||(e.info.popup_campaign_listener.onEnd=function(){}),t.isFunction(e.info.popup_campaign_listener.onFailed)||(e.info.popup_campaign_listener.onFailed=function(){}),t.isFunction(e.info.popup_campaign_listener.onClick)||(e.info.popup_campaign_listener.onClick=function(){})):(e.info.supportCustom="withoutCampaignListener",e.info.popup_campaign_listener={shouldStart:function(){return!0},onClick:function(){},onStart:function(){},onEnd:function(){},onFailed:function(){}}),!0},e.getBridgeState=function(){return!t.isObject(e.sa.para.app_js_bridge)||!e.sa.para.app_js_bridge.is_mui&&(!e.sa.bridge||!e.sa.bridge.is_verify_success)},e.init=function(){var t=window.sensorsDataAnalytic201505;if(e.sa=t,t&&t.readyState&&t.readyState.state>=3||!t.on)l.apply(this,arguments);else{var n=this,i=arguments;t&&t.on("sdkReady",function(){l.apply(n,i)})}},e.plugin_name="Popup",window.SensorsDataWebJSSDKPlugin&&"[object Object]"==Object.prototype.toString.call(window.SensorsDataWebJSSDKPlugin)?(window.SensorsDataWebJSSDKPlugin.popup=window.SensorsDataWebJSSDKPlugin.popup||e,window.SensorsDataWebJSSDKPlugin.Popup=window.SensorsDataWebJSSDKPlugin.Popup||e):window.SensorsDataWebJSSDKPlugin={popup:e,Popup:e},e});